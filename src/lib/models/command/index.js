function _0x2adb(_0x81aec9, _0x556d40) { const _0x407a85 = _0x407a(); return _0x2adb = function (_0x2adb4b, _0x183e01) { _0x2adb4b = _0x2adb4b - 0x99; let _0x52e0cc = _0x407a85[_0x2adb4b]; return _0x52e0cc; }, _0x2adb(_0x81aec9, _0x556d40); } (function (_0x266a15, _0x5e8caf) { const _0x41ee73 = _0x2adb, _0x3e2ee9 = _0x266a15(); while (!![]) { try { const _0xf5e890 = parseInt(_0x41ee73(0xae)) / 0x1 * (parseInt(_0x41ee73(0xa2)) / 0x2) + -parseInt(_0x41ee73(0x9d)) / 0x3 + -parseInt(_0x41ee73(0xa0)) / 0x4 + parseInt(_0x41ee73(0xb0)) / 0x5 * (-parseInt(_0x41ee73(0x99)) / 0x6) + -parseInt(_0x41ee73(0xaa)) / 0x7 * (-parseInt(_0x41ee73(0xa5)) / 0x8) + parseInt(_0x41ee73(0xac)) / 0x9 * (-parseInt(_0x41ee73(0x9a)) / 0xa) + parseInt(_0x41ee73(0xab)) / 0xb; if (_0xf5e890 === _0x5e8caf) break; else _0x3e2ee9['push'](_0x3e2ee9['shift']()); } catch (_0x4ad763) { _0x3e2ee9['push'](_0x3e2ee9['shift']()); } } }(_0x407a, 0x3ee86)); import _0xd05c47 from '../mail-sender/template'; import _0x227592 from '../../database'; import { sendMailCustom } from '../mail-sender/customSendMail'; function _0x407a() { const _0x42dfb2 = ['SELECT\x20users.nom\x20as\x20\x27nom\x27,users.prenom\x20as\x20\x27prenom\x27,\x20commandes.amount\x20as\x20\x27amount\x27,\x20users.email\x20as\x20\x27emailUser\x27,boutique.nom\x20AS\x20\x27boutiqueNom\x27,boutiqueCategorie.nom\x20AS\x20\x27catboutiqueNom\x27\x20FROM\x20commandes\x20INNER\x20JOIN\x20users\x20ON\x20users.hashId\x20=\x20commandes.userID\x20INNER\x20JOIN\x20boutique\x20ON\x20commandes.shopID\x20=\x20boutique.id\x20INNER\x20JOIN\x20boutiqueCategorie\x20ON\x20boutiqueCategorie.id\x20=\x20boutique.categorieId\x20\x20WHERE\x20commandes.id\x20=', '879624pipNTS', 'SELECT\x20*\x20FROM\x20commandes\x20WHERE\x20id\x20=', 'UPDATE\x20commandes\x20SET\x20status\x20=?\x20,code_promo=?\x20WHERE\x20id\x20=\x20?\x20', '831416HZlepO', 'Validation\x20commande\x20chez\x20MAXCADEAU', '188btXrHc', 'REFUSED', ')\x20WHERE\x20hashId\x20=\x20\x22', '136KroxNL', 'then', 'INSERT\x20INTO\x20commandes\x20(userID,\x20shopID,status,\x20amount,date)\x20VALUES\x20(?,?,?,?,?)', 'Email\x20not\x20send', '\x20en\x20succÃ¨s', '198177sGuLAA', '9467425ppGdJJ', '621VxbYaW', 'log', '1504yDFAYJ', 'UPDATE\x20users\x20SET\x20euros\x20=\x20(euros\x20+\x20', '20ptjXCU', 'Erreur', 'toLocaleDateString', 'Bancaire', 'L\x27etat\x20', 'success', '623850alKCnD', '44740zYPvsL', 'Paypal']; _0x407a = function () { return _0x42dfb2; }; return _0x407a(); } export async function addCommand(_0x4dac9d, _0x4a83ec, _0x3d760d) { const _0x962bb2 = _0x2adb; try { const _0xdc90f8 = await _0x227592({ 'query': _0x962bb2(0xa7), 'values': [_0x4dac9d, _0x4a83ec, 'PENDING', _0x3d760d, new Date()[_0x962bb2(0xb2)]()] }); return !![]; } catch (_0x57fa6d) { return console[_0x962bb2(0xad)](_0x57fa6d), ![]; } } export async function getCommandByUser(_0x5abebb) { try { const _0x16c1e2 = await _0x227592({ 'query': 'SELECT\x20commandes.status,commandes.code_promo,\x20commandes.amount,boutique.nom\x20as\x20bnom,boutiqueCategorie.nom\x20as\x20cnom\x20\x20FROM\x20commandes\x20INNER\x20JOIN\x20boutique\x20ON\x20commandes.shopID\x20=\x20boutique.id\x20INNER\x20JOIN\x20boutiqueCategorie\x20ON\x20boutiqueCategorie.id\x20=\x20boutique.categorieId\x20WHERE\x20commandes.userID\x20=\x20?', 'values': [_0x5abebb] }); return _0x16c1e2; } catch (_0x14af36) { return console['log'](_0x14af36), ![]; } } export async function getCommandByUserOrderByDateDesc(_0x530370) { const _0x4caeb5 = _0x2adb; try { const _0x53f75d = await _0x227592({ 'query': 'SELECT\x20commandes.status,commandes.code_promo,\x20commandes.amount,boutique.nom\x20as\x20bnom,boutiqueCategorie.nom\x20as\x20cnom,\x20commandes.date\x20\x20\x20FROM\x20commandes\x20INNER\x20JOIN\x20boutique\x20ON\x20commandes.shopID\x20=\x20boutique.id\x20INNER\x20JOIN\x20boutiqueCategorie\x20ON\x20boutiqueCategorie.id\x20=\x20boutique.categorieId\x20WHERE\x20commandes.userID\x20=\x20?\x20ORDER\x20BY\x20STR_TO_DATE(date,\x20\x27%m/%d/%Y\x27)\x20DESC\x20', 'values': [_0x530370] }); return _0x53f75d; } catch (_0x47dbea) { return console[_0x4caeb5(0xad)](_0x47dbea), ![]; } } export async function getAllCommandes() { const _0x129914 = _0x2adb; try { const _0x388f45 = await _0x227592({ 'query': 'SELECT\x20*,\x20commandes.id,\x20commandes.status,\x20commandes.amount,boutique.nom\x20as\x20bnom,boutiqueCategorie.nom\x20as\x20cnom,\x20users.nom\x20as\x20unom,\x20users.prenom\x20as\x20uprenom\x20\x20FROM\x20commandes\x20INNER\x20JOIN\x20boutique\x20ON\x20commandes.shopID\x20=\x20boutique.id\x20INNER\x20JOIN\x20boutiqueCategorie\x20ON\x20boutiqueCategorie.id\x20=\x20boutique.categorieId\x20INNER\x20JOIN\x20users\x20on\x20commandes.userID\x20=\x20users.hashId\x20WHERE\x20commandes.status=\x27PENDING\x27' }); return _0x388f45; } catch (_0x296baa) { return console[_0x129914(0xad)](_0x296baa), ![]; } } export async function validateCommande(_0x2fbc20, _0xaca597, _0x2c7063) { const _0x398efc = _0x2adb; if (_0x2fbc20 === _0x398efc(0xa3)) { const _0xa5ab90 = await _0x227592({ 'query': _0x398efc(0x9e) + _0xaca597 }), { userID: _0x291c67, amount: _0x55d859 } = await _0xa5ab90[0x0]; await _0x227592({ 'query': _0x398efc(0xaf) + _0x55d859 + _0x398efc(0xa4) + _0x291c67 + '\x22\x20' }); try { return await _0x227592({ 'query': 'UPDATE\x20commandes\x20SET\x20status\x20=?\x20WHERE\x20id\x20=\x20?\x20', 'values': [_0x2fbc20, _0xaca597] }), { 'message': _0x398efc(0xb4) + _0x2fbc20 + _0x398efc(0xa9), 'success': !![] }; } catch (_0x3a9eec) { return { 'message': 'Erreur', 'success': ![], 'error': _0x3a9eec }; } } const _0x34b6f6 = await _0x227592({ 'query': _0x398efc(0x9c) + _0xaca597 }), { catboutiqueNom: _0x40150a, emailUser: _0x246212, amount: _0x30e284, boutiqueNom: _0x459ffb, nom: _0x13ebeb, prenom: _0x2dc6ab } = _0x34b6f6[0x0]; var _0x459741; if (_0x2fbc20 === 'ACCEPTED') { if (_0x40150a == 'Carte-Cadeaux') { const _0x21f6eb = { 'email': _0x246212, 'subject': _0x398efc(0xa1), 'html': _0xd05c47('' + _0x246212, _0x459ffb, _0x2c7063, _0x30e284, _0x2dc6ab, _0x13ebeb) }; await sendMailCustom(_0x21f6eb)['then'](_0x1e8ac1 => { _0x459741 = _0x1e8ac1['success']; }); } else { const _0x5eb790 = { 'email': _0x246212, 'subject': _0x398efc(0xa1), 'html': _0xd05c47('' + _0x246212, _0x459ffb == _0x398efc(0x9b) ? _0x398efc(0x9b) : _0x398efc(0xb3), '', _0x30e284, _0x2dc6ab, _0x13ebeb) }; await sendMailCustom(_0x5eb790)[_0x398efc(0xa6)](_0x4ce062 => { const _0x586d8a = _0x398efc; _0x459741 = _0x4ce062[_0x586d8a(0xb5)]; }); } } if (!_0x459741) return { 'message': _0x398efc(0xa8), 'success': ![] }; else try { return await _0x227592({ 'query': _0x398efc(0x9f), 'values': [_0x2fbc20, _0x2c7063, _0xaca597] }), { 'message': 'L\x27etat\x20' + _0x2fbc20 + _0x398efc(0xa9), 'success': !![] }; } catch (_0x1e1249) { return { 'message': _0x398efc(0xb1), 'success': ![], 'error': _0x1e1249 }; } }
